<div class="admin-card">
  <h2>👥 Users Management</h2>

  <% if params[:error] %>
    <div class="alert alert-danger" style="margin-bottom: 1rem;">
      <strong>❌ Error:</strong> <%= params[:error] %>
    </div>
  <% end %>

  <div style="margin-bottom: 1rem;">
    <%= form_with url: admin_users_path, method: :get, local: true do |form| %>
      <div style="display: flex; gap: 1rem; align-items: end;">
        <div class="form-group" style="flex: 1;">
          <%= form.label :search, "Search by email" %>
          <%= form.text_field :search, value: params[:search], class: "form-control", placeholder: "Enter email..." %>
        </div>
        <div>
          <%= form.submit "Search", class: "btn btn-primary" %>
          <%= link_to "Clear", admin_users_path, class: "btn btn-secondary" %>
        </div>
      </div>
    <% end %>
  </div>

  <%= link_to "➕ New User", new_admin_user_path, class: "btn btn-primary", style: "margin-bottom: 1rem;" %>

  <table class="table">
    <thead>
      <tr>
        <th>ID</th>
        <th>Email</th>
        <th>Created</th>
        <th>Updated</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @users.each do |user| %>
        <tr>
          <td><%= user.id %></td>
          <td><%= user.email %></td>
          <td><%= user.created_at.strftime("%Y-%m-%d %H:%M") %></td>
          <td><%= user.updated_at.strftime("%Y-%m-%d %H:%M") %></td>
          <td style="white-space: nowrap; display: flex; gap: 0.25rem; align-items: center;">
            <%= link_to "👁️ View", admin_user_path(user), class: "btn btn-secondary btn-sm" %>
            <%= link_to "✏️ Edit", edit_admin_user_path(user), class: "btn btn-secondary btn-sm" %>
            <%= form_with url: admin_user_path(user), method: :post, local: true, style: "display: inline;" do |form| %>
              <%= form.hidden_field :action_type, value: 'delete' %>
              <%= form.submit "🗑️",
                  class: "btn btn-outline-danger btn-sm",
                  title: "Delete user",
                  data: { confirm: "Are you sure you want to delete this user?" } %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if @users.respond_to?(:current_page) %>
    <div style="text-align: center; margin-top: 1rem;">
      <%= paginate @users %>
    </div>
  <% end %>
</div>
